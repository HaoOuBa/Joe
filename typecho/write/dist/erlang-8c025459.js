var typeWords=["-type","-spec","-export_type","-opaque"],keywordWords=["after","begin","catch","case","cond","end","fun","if","let","of","query","receive","try","when"],separatorRE=/[\->,;]/,separatorWords=["->",";",","],operatorAtomWords=["and","andalso","band","bnot","bor","bsl","bsr","bxor","div","not","or","orelse","rem","xor"],operatorSymbolRE=/[\+\-\*\/<>=\|:!]/,operatorSymbolWords=["=","+","-","*","/",">",">=","<","=<","=:=","==","=/=","/=","||","<-","!"],openParenRE=/[<\(\[\{]/,openParenWords=["<<","(","[","{"],closeParenRE=/[>\)\]\}]/,closeParenWords=["}","]",")",">>"],guardWords=["is_atom","is_binary","is_bitstring","is_boolean","is_float","is_function","is_integer","is_list","is_number","is_pid","is_port","is_record","is_reference","is_tuple","atom","binary","bitstring","boolean","function","integer","list","number","pid","port","record","reference","tuple"],bifWords=["abs","adler32","adler32_combine","alive","apply","atom_to_binary","atom_to_list","binary_to_atom","binary_to_existing_atom","binary_to_list","binary_to_term","bit_size","bitstring_to_list","byte_size","check_process_code","contact_binary","crc32","crc32_combine","date","decode_packet","delete_module","disconnect_node","element","erase","exit","float","float_to_list","garbage_collect","get","get_keys","group_leader","halt","hd","integer_to_list","internal_bif","iolist_size","iolist_to_binary","is_alive","is_atom","is_binary","is_bitstring","is_boolean","is_float","is_function","is_integer","is_list","is_number","is_pid","is_port","is_process_alive","is_record","is_reference","is_tuple","length","link","list_to_atom","list_to_binary","list_to_bitstring","list_to_existing_atom","list_to_float","list_to_integer","list_to_pid","list_to_tuple","load_module","make_ref","module_loaded","monitor_node","node","node_link","node_unlink","nodes","notalive","now","open_port","pid_to_list","port_close","port_command","port_connect","port_control","pre_loaded","process_flag","process_info","processes","purge_module","put","register","registered","round","self","setelement","size","spawn","spawn_link","spawn_monitor","spawn_opt","split_binary","statistics","term_to_binary","time","throw","tl","trunc","tuple_size","tuple_to_list","unlink","unregister","whereis"],anumRE=/[\w@Ø-ÞÀ-Öß-öø-ÿ]/,escapesRE=/[0-7]{1,3}|[bdefnrstv\\"']|\^[a-zA-Z]|x[0-9a-zA-Z]{2}|x{[0-9a-zA-Z]+}/;function tokenizer(e,r){if(r.in_string)return r.in_string=!doubleQuote(e),rval(r,e,"string");if(r.in_atom)return r.in_atom=!singleQuote(e),rval(r,e,"atom");if(e.eatSpace())return rval(r,e,"whitespace");if(!peekToken(r)&&e.match(/-\s*[a-zß-öø-ÿ][\wØ-ÞÀ-Öß-öø-ÿ]*/))return is_member(e.current(),typeWords)?rval(r,e,"type"):rval(r,e,"attribute");var t=e.next();if("%"==t)return e.skipToEnd(),rval(r,e,"comment");if(":"==t)return rval(r,e,"colon");if("?"==t)return e.eatSpace(),e.eatWhile(anumRE),rval(r,e,"macro");if("#"==t)return e.eatSpace(),e.eatWhile(anumRE),rval(r,e,"record");if("$"==t)return"\\"!=e.next()||e.match(escapesRE)?rval(r,e,"number"):rval(r,e,"error");if("."==t)return rval(r,e,"dot");if("'"==t){if(!(r.in_atom=!singleQuote(e))){if(e.match(/\s*\/\s*[0-9]/,!1))return e.match(/\s*\/\s*[0-9]/,!0),rval(r,e,"fun");if(e.match(/\s*\(/,!1)||e.match(/\s*:/,!1))return rval(r,e,"function")}return rval(r,e,"atom")}if('"'==t)return r.in_string=!doubleQuote(e),rval(r,e,"string");if(/[A-Z_Ø-ÞÀ-Ö]/.test(t))return e.eatWhile(anumRE),rval(r,e,"variable");if(/[a-z_ß-öø-ÿ]/.test(t)){if(e.eatWhile(anumRE),e.match(/\s*\/\s*[0-9]/,!1))return e.match(/\s*\/\s*[0-9]/,!0),rval(r,e,"fun");var n=e.current();return is_member(n,keywordWords)?rval(r,e,"keyword"):is_member(n,operatorAtomWords)?rval(r,e,"operator"):e.match(/\s*\(/,!1)?!is_member(n,bifWords)||":"==peekToken(r).token&&"erlang"!=peekToken(r,2).token?is_member(n,guardWords)?rval(r,e,"guard"):rval(r,e,"function"):rval(r,e,"builtin"):":"==lookahead(e)?rval(r,e,"erlang"==n?"builtin":"function"):is_member(n,["true","false"])?rval(r,e,"boolean"):rval(r,e,"atom")}n=/[0-9]/;return n.test(t)?(e.eatWhile(n),e.eat("#")?e.eatWhile(/[0-9a-zA-Z]/)||e.backUp(1):e.eat(".")&&(e.eatWhile(n)?e.eat(/[eE]/)&&(e.eat(/[-+]/)?e.eatWhile(n)||e.backUp(2):e.eatWhile(n)||e.backUp(1)):e.backUp(1)),rval(r,e,"number")):nongreedy(e,openParenRE,openParenWords)?rval(r,e,"open_paren"):nongreedy(e,closeParenRE,closeParenWords)?rval(r,e,"close_paren"):greedy(e,separatorRE,separatorWords)?rval(r,e,"separator"):greedy(e,operatorSymbolRE,operatorSymbolWords)?rval(r,e,"operator"):rval(r,e,null)}function nongreedy(e,r,t){if(1==e.current().length&&r.test(e.current())){for(e.backUp(1);r.test(e.peek());)if(e.next(),is_member(e.current(),t))return!0;e.backUp(e.current().length-1)}return!1}function greedy(e,r,t){if(1==e.current().length&&r.test(e.current())){for(;r.test(e.peek());)e.next();for(;0<e.current().length;){if(is_member(e.current(),t))return!0;e.backUp(1)}e.next()}return!1}function doubleQuote(e){return quote(e,'"',"\\")}function singleQuote(e){return quote(e,"'","\\")}function quote(e,r,t){for(;!e.eol();){var n=e.next();if(n==r)return!0;n==t&&e.next()}return!1}function lookahead(e){e=e.match(/([\n\s]+|%[^\n]*\n)*(.)/,!1);return e?e.pop():""}function is_member(e,r){return-1<r.indexOf(e)}function rval(e,r,t){switch(pushToken(e,realToken(t,r)),t){case"atom":return"atom";case"attribute":return"attribute";case"boolean":return"atom";case"builtin":return"builtin";case"close_paren":case"colon":return null;case"comment":return"comment";case"dot":return null;case"error":return"error";case"fun":return"meta";case"function":return"tag";case"guard":return"property";case"keyword":return"keyword";case"macro":return"macroName";case"number":return"number";case"open_paren":return null;case"operator":return"operator";case"record":return"bracket";case"separator":return null;case"string":return"string";case"type":return"def";case"variable":return"variable";default:return null}}function aToken(e,r,t,n){return{token:e,column:r,indent:t,type:n}}function realToken(e,r){return aToken(r.current(),r.column(),r.indentation(),e)}function fakeToken(e){return aToken(e,0,0,e)}function peekToken(e,r){var t=e.tokenStack.length,r=r||1;return!(t<r)&&e.tokenStack[t-r]}function pushToken(e,r){"comment"!=r.type&&"whitespace"!=r.type&&(e.tokenStack=maybe_drop_pre(e.tokenStack,r),e.tokenStack=maybe_drop_post(e.tokenStack))}function maybe_drop_pre(e,r){var t=e.length-1;return 0<t&&"record"===e[t].type&&"dot"===r.type?e.pop():(0<t&&"group"===e[t].type&&e.pop(),e.push(r)),e}function maybe_drop_post(e){if(!e.length)return e;var r=e.length-1;if("dot"===e[r].type)return[];if(1<r&&"fun"===e[r].type&&"fun"===e[r-1].token)return e.slice(0,r-1);switch(e[r].token){case"}":return d(e,{g:["{"]});case"]":return d(e,{i:["["]});case")":return d(e,{i:["("]});case">>":return d(e,{i:["<<"]});case"end":return d(e,{i:["begin","case","fun","if","receive","try"]});case",":return d(e,{e:["begin","try","when","->",",","(","[","{","<<"]});case"->":return d(e,{r:["when"],m:["try","if","case","receive"]});case";":return d(e,{E:["case","fun","if","receive","try","when"]});case"catch":return d(e,{e:["try"]});case"of":return d(e,{e:["case"]});case"after":return d(e,{e:["receive","try"]});default:return e}}function d(e,r){for(var t in r)for(var n=e.length-1,o=r[t],a=n-1;-1<a;a--)if(is_member(e[a].token,o)){var i=e.slice(0,a);switch(t){case"m":return i.concat(e[a]).concat(e[n]);case"r":return i.concat(e[n]);case"i":return i;case"g":return i.concat(fakeToken("group"));case"E":case"e":return i.concat(e[a])}}return"E"==t?[]:e}function indenter(e,r,t){var n,o=wordafter(r),a=peekToken(e,1),r=peekToken(e,2);return e.in_string||e.in_atom?null:r?"when"==a.token?a.column+t.unit:"when"===o&&"function"===r.type?r.indent+t.unit:"("===o&&"fun"===a.token?a.column+3:"catch"===o&&(n=getToken(e,["try"]))?n.column:is_member(o,["end","after","of"])?(n=getToken(e,["begin","case","fun","if","receive","try"]))?n.column:null:is_member(o,closeParenWords)?(n=getToken(e,openParenWords))?n.column:null:is_member(a.token,[",","|","||"])||is_member(o,[",","|","||"])?(n=postcommaToken(e))?n.column+n.token.length:t.unit:"->"==a.token?is_member(r.token,["receive","case","if","try"])?r.column+t.unit+t.unit:r.column+t.unit:is_member(a.token,openParenWords)?a.column+a.token.length:truthy(n=defaultToken(e))?n.column+t.unit:0:0}function wordafter(e){e=e.match(/,|[a-z]+|\}|\]|\)|>>|\|+|\(/);return truthy(e)&&0===e.index?e[0]:""}function postcommaToken(e){var r=e.tokenStack.slice(0,-1),e=getTokenIndex(r,"type",["open_paren"]);return!!truthy(r[e])&&r[e]}function defaultToken(e){var r=e.tokenStack,t=getTokenIndex(r,"type",["open_paren","separator","keyword"]),e=getTokenIndex(r,"type",["operator"]);return truthy(t)&&truthy(e)&&t<e?r[t+1]:!!truthy(t)&&r[t]}function getToken(e,r){e=e.tokenStack,r=getTokenIndex(e,"token",r);return!!truthy(e[r])&&e[r]}function getTokenIndex(e,r,t){for(var n=e.length-1;-1<n;n--)if(is_member(e[n][r],t))return n;return!1}function truthy(e){return!1!==e&&null!=e}const erlang={startState(){return{tokenStack:[],in_string:!1,in_atom:!1}},token:tokenizer,indent:indenter,languageData:{commentTokens:{line:"%"}}};export{erlang};
