(function(){var t,e=[].slice;t=function(){function t(){this.commonWhiteList="kbd|b|i|strong|em|sup|sub|br|code|del|a|hr|small",this.blockHtmlTags="p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|address|form|fieldset|iframe|hr|legend|article|section|nav|aside|hgroup|header|footer|figcaption|svg|script|noscript",this.specialWhiteList={table:"table|tbody|thead|tfoot|tr|td|th"},this.hooks={},this.html=!1,this.line=!1,this.blockParsers=[["code",10],["shtml",20],["pre",30],["ahtml",40],["shr",50],["list",60],["math",70],["html",80],["footnote",90],["definition",100],["quote",110],["table",120],["sh",130],["mh",140],["dhr",150],["default",9999]],this.parsers={}}var n,r,s,l,i,o,a,c;return c=function(t){return t.charAt(0).toUpperCase()+t.substring(1)},i=function(t){return t.replace(/[-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},l="A-Za-zªµºÀ-ÖØ-öø-ˁˆ-ˑˠ-ˤˬˮͰ-ʹͶͷͺ-ͽΆΈ-ΊΌΎ-ΡΣ-ϵϷ-ҁҊ-ԧԱ-Ֆՙա-ևא-תװ-ײؠ-يٮٯٱ-ۓەۥۦۮۯۺ-ۼۿܐܒ-ܯݍ-ޥޱߊ-ߪߴߵߺࠀ-ࠕࠚࠤࠨࡀ-ࡘࢠࢢ-ࢬऄ-हऽॐक़-ॡॱ-ॷॹ-ॿঅ-ঌএঐও-নপ-রলশ-হঽৎড়ঢ়য়-ৡৰৱਅ-ਊਏਐਓ-ਨਪ-ਰਲਲ਼ਵਸ਼ਸਹਖ਼-ੜਫ਼ੲ-ੴઅ-ઍએ-ઑઓ-નપ-રલળવ-હઽૐૠૡଅ-ଌଏଐଓ-ନପ-ରଲଳଵ-ହଽଡ଼ଢ଼ୟ-ୡୱஃஅ-ஊஎ-ஐஒ-கஙசஜஞடணதந-பம-ஹௐఅ-ఌఎ-ఐఒ-నప-ళవ-హఽౘౙౠౡಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹಽೞೠೡೱೲഅ-ഌഎ-ഐഒ-ഺഽൎൠൡൺ-ൿඅ-ඖක-නඳ-රලව-ෆก-ะาำเ-ๆກຂຄງຈຊຍດ-ທນ-ຟມ-ຣລວສຫອ-ະາຳຽເ-ໄໆໜ-ໟༀཀ-ཇཉ-ཬྈ-ྌက-ဪဿၐ-ၕၚ-ၝၡၥၦၮ-ၰၵ-ႁႎႠ-ჅჇჍა-ჺჼ-ቈቊ-ቍቐ-ቖቘቚ-ቝበ-ኈኊ-ኍነ-ኰኲ-ኵኸ-ኾዀዂ-ዅወ-ዖዘ-ጐጒ-ጕጘ-ፚᎀ-ᎏᎠ-Ᏼᐁ-ᙬᙯ-ᙿᚁ-ᚚᚠ-ᛪᜀ-ᜌᜎ-ᜑᜠ-ᜱᝀ-ᝑᝠ-ᝬᝮ-ᝰក-ឳៗៜᠠ-ᡷᢀ-ᢨᢪᢰ-ᣵᤀ-ᤜᥐ-ᥭᥰ-ᥴᦀ-ᦫᧁ-ᧇᨀ-ᨖᨠ-ᩔᪧᬅ-ᬳᭅ-ᭋᮃ-ᮠᮮᮯᮺ-ᯥᰀ-ᰣᱍ-ᱏᱚ-ᱽᳩ-ᳬᳮ-ᳱᳵᳶᴀ-ᶿḀ-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼⁱⁿₐ-ₜℂℇℊ-ℓℕℙ-ℝℤΩℨK-ℭℯ-ℹℼ-ℿⅅ-ⅉⅎↃↄⰀ-Ⱞⰰ-ⱞⱠ-ⳤⳫ-ⳮⳲⳳⴀ-ⴥⴧⴭⴰ-ⵧⵯⶀ-ⶖⶠ-ⶦⶨ-ⶮⶰ-ⶶⶸ-ⶾⷀ-ⷆⷈ-ⷎⷐ-ⷖⷘ-ⷞⸯ々〆〱-〵〻〼ぁ-ゖゝ-ゟァ-ヺー-ヿㄅ-ㄭㄱ-ㆎㆠ-ㆺㇰ-ㇿ㐀-䶵一-鿌ꀀ-ꒌꓐ-ꓽꔀ-ꘌꘐ-ꘟꘪꘫꙀ-ꙮꙿ-ꚗꚠ-ꛥꜗ-ꜟꜢ-ꞈꞋ-ꞎꞐ-ꞓꞠ-Ɦꟸ-ꠁꠃ-ꠅꠇ-ꠊꠌ-ꠢꡀ-ꡳꢂ-ꢳꣲ-ꣷꣻꤊ-ꤥꤰ-ꥆꥠ-ꥼꦄ-ꦲꧏꨀ-ꨨꩀ-ꩂꩄ-ꩋꩠ-ꩶꩺꪀ-ꪯꪱꪵꪶꪹ-ꪽꫀꫂꫛ-ꫝꫠ-ꫪꫲ-ꫴꬁ-ꬆꬉ-ꬎꬑ-ꬖꬠ-ꬦꬨ-ꬮꯀ-ꯢ가-힣ힰ-ퟆퟋ-ퟻ豈-舘並-龎ﬀ-ﬆﬓ-ﬗיִײַ-ﬨשׁ-זּטּ-לּמּנּסּףּפּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻﹰ-ﹴﹶ-ﻼＡ-Ｚａ-ｚｦ-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜ",o=function(t,e,n){var r,s,l,a,c,h;if(t instanceof Array)if(e instanceof Array)for(r=s=0,a=t.length;s<a;r=++s)h=t[r],n=o(h,e[r],n);else for(l=0,c=t.length;l<c;l++)h=t[l],n=o(h,e,n);else t=i(t),n=n.replace(new RegExp(t,"g"),e.replace(/\$/g,"$$$$"));return n},s=function(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},a=function(t,e){var n,r,s,l,o;if(null==e&&(e=null),null!=e){for(o="",r=s=0,l=e.length-1;0<=l?s<=l:s>=l;r=0<=l?++s:--s)n=e[r],n=i(n),o+=n;return o="["+o+"]*",t.replace(new RegExp("^"+o),"").replace(new RegExp(o+"$"),"")}return t.replace(/^\s*/,"").replace(/\s*$/,"")},n=function(t){var e,n,r,s;if(s=[],t instanceof Array)for(n=e=0,r=t.length;e<r;n=++e)t[n],s.push(n);else for(n in t)s.push(n);return s},r=function(t){var e,n,r,s,l;if(s=[],t instanceof Array)for(n=0,r=t.length;n<r;n++)l=t[n],s.push(l);else for(e in t)l=t[e],s.push(l);return s},t.prototype.makeHtml=function(t){var e,n,r,s,l,i;for(this.footnotes=[],this.definitions={},this.holders={},this.uniqid=Math.ceil(1e7*Math.random())+Math.ceil(1e7*Math.random()),this.id=0,this.blockParsers.sort(function(t,e){return t[1]<e[1]?-1:1}),i=this.blockParsers,n=0,r=i.length;n<r;n++)l=i[n],s=l[0],void 0!==l[2]?this.parsers[s]=l[2]:this.parsers[s]=this["parseBlock"+c(s)].bind(this);return t=this.initText(t),e=this.parse(t),e=this.makeFootnotes(e),e=this.optimizeLines(e),this.call("makeHtml",e)},t.prototype.enableHtml=function(t){this.html=null==t||t},t.prototype.enableLine=function(t){this.line=null==t||t},t.prototype.hook=function(t,e){return null==this.hooks[t]&&(this.hooks[t]=[]),this.hooks[t].push(e)},t.prototype.makeHolder=function(t){var e;return e="|\r"+this.uniqid+this.id+"\r|",this.id+=1,this.holders[e]=t,e},t.prototype.initText=function(t){return t.replace(/\t/g,"    ").replace(/\r/g,"").replace(/(\u000A|\u000D|\u2028|\u2029)/g,"\n")},t.prototype.makeFootnotes=function(t){var e,n;if(this.footnotes.length>0){for(t+='<div class="footnotes"><hr><ol>',e=1;n=this.footnotes.shift();)"string"==typeof n?n+=' <a href="#fnref-'+e+'" class="footnote-backref">&#8617;</a>':(n[n.length-1]+=' <a href="#fnref-'+e+'" class="footnote-backref">&#8617;</a>',n=n.length>1?this.parse(n.join("\n")):this.parseInline(n[0])),t+='<li id="fn-'+e+'">'+n+"</li>",e+=1;t+="</ol></div>"}return t},t.prototype.parse=function(t,e,n){var r,s,l,i,o,a,h,p,u,f,k,m,g;for(null==e&&(e=!1),null==n&&(n=0),p=[],s=this.parseBlock(t,p),o="",e&&1===s.length&&"normal"===s[0][0]&&(s[0][3]=!0),a=0,h=s.length;a<h;a++)r=s[a],m=r[0],k=r[1],l=r[2],g=r[3],i=p.slice(k,l+1),u="parse"+c(m),i=this.call("before"+c(u),i,g),f=this[u](i,g,k+n,l+n),f=this.call("after"+c(u),f,g),o+=f;return o},t.prototype.call=function(){var t,n,r,s,l,i,o;if(i=arguments[0],t=2<=arguments.length?e.call(arguments,1):[],o=t[0],null==this.hooks[i])return o;for(l=this.hooks[i],r=0,s=l.length;r<s;r++)n=l[r],o=n.apply(this,t),t[0]=o;return o},t.prototype.releaseHolder=function(t,e){var s;for(null==e&&(e=!0),s=0;t.indexOf("\r")>=0&&s<10;)t=o(n(this.holders),r(this.holders),t),s+=1;return e&&(this.holders={}),t},t.prototype.markLine=function(t,e){return null==e&&(e=-1),this.line?(e=e<0?t:e,'<span class="line" data-start="'+t+'" data-end="'+e+'" data-id="'+this.uniqid+'"></span>'):""},t.prototype.markLines=function(t,e){var n,r;return n=-1,this.line?t.map((r=this,function(t){return n+=1,r.markLine(e+n)+t})):t},t.prototype.optimizeLines=function(t){var n,r;return n=0,r=new RegExp('class="line" data\\-start="([0-9]+)" data\\-end="([0-9]+)" (data\\-id="'+this.uniqid+'")',"g"),this.line?t.replace(r,function(){var t,r;return t=1<=arguments.length?e.call(arguments,0):[],r=n!==parseInt(t[1])?'class="line" data-start="'+n+'" data-start-original="'+t[1]+'" data-end="'+t[2]+'" '+t[3]:t[0],n=1+parseInt(t[2]),r}):t},t.prototype.parseInline=function(t,n,r,i){var a,c;return null==n&&(n=""),null==r&&(r=!0),null==i&&(i=!0),t=this.call("beforeParseInline",t),t=t.replace(/(^|[^\\])(`+)(.+?)\2/gm,(c=this,function(){var t;return t=1<=arguments.length?e.call(arguments,0):[],t[1]+c.makeHolder("<code>"+s(t[3])+"</code>")})),t=t.replace(/(^|[^\\])(\$+)(.+?)\2/gm,function(t){return function(){var n;return n=1<=arguments.length?e.call(arguments,0):[],n[1]+t.makeHolder(n[2]+s(n[3])+n[2])}}(this)),t=t.replace(/\\(.)/g,function(t){return function(){var n,r,l;return r=1<=arguments.length?e.call(arguments,0):[],l=r[1].match(/^[-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]$/)?"":"\\",n=s(r[1]),n=n.replace(/\$/g,"&dollar;"),t.makeHolder(l+n)}}(this)),t=t.replace(/<(https?:\/\/.+)>/gi,function(t){return function(){var n,r,s;return r=1<=arguments.length?e.call(arguments,0):[],s=t.cleanUrl(r[1]),n=t.call("parseLink",r[1]),t.makeHolder('<a href="'+s+'">'+n+"</a>")}}(this)),t=t.replace(/<(\/?)([a-z0-9-]+)(\s+[^>]*)?>/gi,function(t){return function(){var r;return r=1<=arguments.length?e.call(arguments,0):[],t.html||("|"+t.commonWhiteList+"|"+n+"|").indexOf("|"+r[2].toLowerCase()+"|")>=0?t.makeHolder(r[0]):t.makeHolder(s(r[0]))}}(this)),this.html&&(t=t.replace(/<!\-\-(.*?)\-\->/g,function(t){return function(){var n;return n=1<=arguments.length?e.call(arguments,0):[],t.makeHolder(n[0])}}(this))),t=o(["<",">"],["&lt;","&gt;"],t),t=t.replace(/\[\^((?:[^\]]|\\\]|\\\[)+?)\]/g,function(t){return function(){var n,r;return r=1<=arguments.length?e.call(arguments,0):[],n=t.footnotes.indexOf(r[1]),n<0&&(n=t.footnotes.length+1,t.footnotes.push(t.parseInline(r[1],"",!1))),t.makeHolder('<sup id="fnref-'+n+'"><a href="#fn-'+n+'" class="footnote-ref">'+n+"</a></sup>")}}(this)),t=t.replace(/!\[((?:[^\]]|\\\]|\\\[)*?)\]\(((?:[^\)]|\\\)|\\\()+?)\)/g,function(t){return function(){var n,r,l;return r=1<=arguments.length?e.call(arguments,0):[],n=s(t.escapeBracket(r[1])),l=t.escapeBracket(r[2]),l=t.cleanUrl(l),t.makeHolder('<img src="'+l+'" alt="'+n+'" title="'+n+'">')}}(this)),t=t.replace(/!\[((?:[^\]]|\\\]|\\\[)*?)\]\[((?:[^\]]|\\\]|\\\[)+?)\]/g,function(t){return function(){var n,r,l;return r=1<=arguments.length?e.call(arguments,0):[],n=s(t.escapeBracket(r[1])),l=null!=t.definitions[r[2]]?'<img src="'+t.definitions[r[2]]+'" alt="'+n+'" title="'+n+'">':n,t.makeHolder(l)}}(this)),t=t.replace(/\[((?:[^\]]|\\\]|\\\[)+?)\]\(((?:[^\)]|\\\)|\\\()+?)\)/g,function(t){return function(){var n,r,s;return r=1<=arguments.length?e.call(arguments,0):[],n=t.parseInline(t.escapeBracket(r[1]),"",!1,!1),s=t.escapeBracket(r[2]),s=t.cleanUrl(s),t.makeHolder('<a href="'+s+'">'+n+"</a>")}}(this)),t=t.replace(/\[((?:[^\]]|\\\]|\\\[)+?)\]\[((?:[^\]]|\\\]|\\\[)+?)\]/g,function(t){return function(){var n,r,s;return r=1<=arguments.length?e.call(arguments,0):[],n=t.parseInline(t.escapeBracket(r[1]),"",!1,!1),s=null!=t.definitions[r[2]]?'<a href="'+t.definitions[r[2]]+'">'+n+"</a>":n,t.makeHolder(s)}}(this)),t=this.parseInlineCallback(t),t=t.replace(/<([_a-z0-9-\.\+]+@[^@]+\.[a-z]{2,})>/gi,'<a href="mailto:$1">$1</a>'),i&&(a=new RegExp('(^|[^"])((https?):['+l+'_0-9-\\./%#!@\\?\\[\\]\\+=~\\|\\,&\\(\\)]+)($|[^"])',"ig"),t=t.replace(a,function(t){return function(){var n,r;return r=1<=arguments.length?e.call(arguments,0):[],n=t.call("parseLink",r[2]),r[1]+'<a href="'+r[2]+'">'+n+"</a>"+r[4]}}(this))),t=this.call("afterParseInlineBeforeRelease",t),t=this.releaseHolder(t,r),t=this.call("afterParseInline",t),t},t.prototype.parseInlineCallback=function(t){var n;return t=t.replace(/(\*{3})((?:.|\r)+?)\1/gm,(n=this,function(){var t;return t=1<=arguments.length?e.call(arguments,0):[],"<strong><em>"+n.parseInlineCallback(t[2])+"</em></strong>"})),t=t.replace(/(\*{2})((?:.|\r)+?)\1/gm,function(t){return function(){var n;return n=1<=arguments.length?e.call(arguments,0):[],"<strong>"+t.parseInlineCallback(n[2])+"</strong>"}}(this)),t=t.replace(/(\*)((?:.|\r)+?)\1/gm,function(t){return function(){var n;return n=1<=arguments.length?e.call(arguments,0):[],"<em>"+t.parseInlineCallback(n[2])+"</em>"}}(this)),t=t.replace(/(\s+|^)(_{3})((?:.|\r)+?)\2(\s+|$)/gm,function(t){return function(){var n;return n=1<=arguments.length?e.call(arguments,0):[],n[1]+"<strong><em>"+t.parseInlineCallback(n[3])+"</em></strong>"+n[4]}}(this)),t=t.replace(/(\s+|^)(_{2})((?:.|\r)+?)\2(\s+|$)/gm,function(t){return function(){var n;return n=1<=arguments.length?e.call(arguments,0):[],n[1]+"<strong>"+t.parseInlineCallback(n[3])+"</strong>"+n[4]}}(this)),t=t.replace(/(\s+|^)(_)((?:.|\r)+?)\2(\s+|$)/gm,function(t){return function(){var n;return n=1<=arguments.length?e.call(arguments,0):[],n[1]+"<em>"+t.parseInlineCallback(n[3])+"</em>"+n[4]}}(this)),t=t.replace(/(~{2})((?:.|\r)+?)\1/gm,function(t){return function(){var n;return n=1<=arguments.length?e.call(arguments,0):[],"<del>"+t.parseInlineCallback(n[2])+"</del>"}}(this)),t},t.prototype.parseBlock=function(t,e){var r,s,l,i,o,a,c,h,p,u,f,k,m;for(f=t.split("\n"),s=0,o=f.length;s<o;s++)c=f[s],e.push(c);for(this.blocks=[],this.current="normal",this.pos=-1,m={special:n(this.specialWhiteList).join("|"),empty:0,html:!1},l=i=0,a=e.length;i<a;l=++i)if(c=e[l],r=this.getBlock(),null!=r&&(r=r.slice(0)),"normal"===this.current||(u=this.parsers[this.current](r,l,c,m,e),u))for(h in k=this.parsers,k)if(p=k[h],h!==this.current&&(u=p(r,l,c,m,e),!u))break;return this.optimizeBlocks(this.blocks,e)},t.prototype.parseBlockList=function(t,e,n,r){var s,l;if(this.isBlock("list")&&!n.match(/^\s*\[((?:[^\]]|\\\]|\\\[)+?)\]:\s*(.+)$/)){if(r.empty<=1&&(s=n.match(/^(\s+)/))&&s[1].length>t[3])return r.empty=0,this.setBlock(e),!1;if(n.match(/^\s*$/)&&0===r.empty)return r.empty+=1,this.setBlock(e),!1}return!(s=n.match(/^(\s*)((?:[0-9]+\.)|\-|\+|\*)\s+/i))||(l=s[1].length,r.empty=0,this.isBlock("list")?this.setBlock(e,l):this.startBlock("list",e,l),!1)},t.prototype.parseBlockCode=function(t,e,n){var r,s,l;return(s=n.match(/^(\s*)(~{3,}|`{3,})([^`~]*)$/i))?(this.isBlock("code")?(r=t[3][2],r?this.combineBlock().setBlock(e):this.setBlock(e).endBlock()):(r=!1,this.isBlock("list")&&(l=t[3],r=l>0&&s[1].length>=l||s[1].length>l),this.startBlock("code",e,[s[1],s[3],r])),!1):!this.isBlock("code")||(this.setBlock(e),!1)},t.prototype.parseBlockShtml=function(t,e,n,r){return n.match(/^(\s*)!!!(\s*)$/)?(this.isBlock("shtml")?this.setBlock(e).endBlock():this.startBlock("shtml",e),!1):!this.isBlock("shtml")||(this.setBlock(e),!1)},t.prototype.parseBlockAhtml=function(t,e,n,r){var s,l,i,o,a;if(this.html)if(l=new RegExp("^\\s*<("+this.blockHtmlTags+")(\\s+[^>]*)?>","i"),a=n.match(l)){if(this.isBlock("ahtml"))return this.setBlock(e),!1;if(void 0===a[2]||"/"!==a[2]){for(this.startBlock("ahtml",e),s=new RegExp("\\s*<("+this.blockHtmlTags+")(\\s+[^>]*)?>","ig");o=s.exec(n),o;)i=o[1];return 0<=n.indexOf("</"+i+">")?this.endBlock():r.html=i,!1}}else{if(r.html&&0<=n.indexOf("</"+r.html+">"))return this.setBlock(e).endBlock(),r.html=!1,!1;if(this.isBlock("ahtml"))return this.setBlock(e),!1;if(a=n.match(/^\s*<!\-\-(.*?)\-\->\s*$/))return this.startBlock("ahtml",e).endBlock(),!1}return!0},t.prototype.parseBlockMath=function(t,e,n){return n.match(/^(\s*)\$\$(\s*)$/)?(this.isBlock("math")?this.setBlock(e).endBlock():this.startBlock("math",e),!1):!this.isBlock("math")||(this.setBlock(e),!1)},t.prototype.parseBlockPre=function(t,e,n,r){return n.match(/^ {4}/)?(this.isBlock("pre")?this.setBlock(e):this.startBlock("pre",e),!1):!this.isBlock("pre")||!n.match(/^\s*$/)||(this.setBlock(e),!1)},t.prototype.parseBlockHtml=function(t,e,n,r){var s,l;return(s=n.match(new RegExp("^\\s*<("+r.special+")(\\s+[^>]*)?>","i")))?(l=s[1].toLowerCase(),this.isBlock("html",l)||this.isBlock("pre")||this.startBlock("html",e,l),!1):(s=n.match(new RegExp("</("+r.special+")>\\s*$","i")))?(l=s[1].toLowerCase(),this.isBlock("html",l)&&this.setBlock(e).endBlock(),!1):!this.isBlock("html")||(this.setBlock(e),!1)},t.prototype.parseBlockFootnote=function(t,e,n){var r,s;return!(r=n.match(/^\[\^((?:[^\]]|\\\]|\\\[)+?)\]:/))||(s=r[0].length-1,this.startBlock("footnote",e,[s,r[1]]),!1)},t.prototype.parseBlockDefinition=function(t,e,n){var r;return!(r=n.match(/^\s*\[((?:[^\]]|\\\]|\\\[)+?)\]:\s*(.+)$/))||(this.definitions[r[1]]=this.cleanUrl(r[2]),this.startBlock("definition",e).endBlock(),!1)},t.prototype.parseBlockQuote=function(t,e,n){var r;return!(r=n.match(/^(\s*)>/))||(this.isBlock("list")&&r[1].length>0?this.setBlock(e):this.isBlock("quote")?this.setBlock(e):this.startBlock("quote",e),!1)},t.prototype.parseBlockTable=function(t,e,n,r,s){var l,i,o,a,c,h,p,u;if(h=n.match(/^((?:(?:(?:\||\+)(?:[ :]*\-+[ :]*)(?:\||\+))|(?:(?:[ :]*\-+[ :]*)(?:\||\+)(?:[ :]*\-+[ :]*))|(?:(?:[ :]*\-+[ :]*)(?:\||\+))|(?:(?:\||\+)(?:[ :]*\-+[ :]*)))+)$/)){if(this.isBlock("table"))t[3][0].push(t[3][2]),t[3][2]+=1,this.setBlock(e,t[3]);else{for(o=0,null==t||"normal"!==t[0]||s[t[2]].match(/^\s*$/)?this.startBlock("table",e):(o=1,this.backBlock(1,"table")),"|"===h[1][0]&&(h[1]=h[1].substring(1),"|"===h[1][h[1].length-1]&&(h[1]=h[1].substring(0,h[1].length-1))),u=h[1].split(/\+|\|/),i=[],a=0,c=u.length;a<c;a++)p=u[a],l="none",(h=p.match(/^\s*(:?)\-+(:?)\s*$/))&&(h[1]&&h[2]?l="center":h[1]?l="left":h[2]&&(l="right")),i.push(l);this.setBlock(e,[[o],i,o+1])}return!1}return!0},t.prototype.parseBlockSh=function(t,e,n){var r,s;return!(r=n.match(/^(#+)(.*)$/))||(s=Math.min(r[1].length,6),this.startBlock("sh",e,s).endBlock(),!1)},t.prototype.parseBlockMh=function(t,e,n,r,s){var l;return!((l=n.match(/^\s*((=|-){2,})\s*$/))&&null!=t&&"normal"===t[0]&&!s[t[2]].match(/^\s*$/))||(this.isBlock("normal")?this.backBlock(1,"mh","="===l[1][0]?1:2).setBlock(e).endBlock():this.startBlock("normal",e),!1)},t.prototype.parseBlockShr=function(t,e,n){return!n.match(/^(\* *){3,}\s*$/)||(this.startBlock("hr",e).endBlock(),!1)},t.prototype.parseBlockDhr=function(t,e,n){return!n.match(/^(- *){3,}\s*$/)||(this.startBlock("hr",e).endBlock(),!1)},t.prototype.parseBlockDefault=function(t,e,n,r){var s;return this.isBlock("footnote")?(s=n.match(/^(\s*)/),s[1].length>=t[3][0]?this.setBlock(e):this.startBlock("normal",e)):this.isBlock("table")?0<=n.indexOf("|")?(t[3][2]+=1,this.setBlock(e,t[3])):this.startBlock("normal",e):this.isBlock("quote")?n.match(/^(\s*)$/)?this.startBlock("normal",e):this.setBlock(e):null==t||"normal"!==t[0]?this.startBlock("normal",e):this.setBlock(e),!0},t.prototype.optimizeBlocks=function(t,e){var n,r,s,l,i,o,a,c,h,p,u,f;for(r=t.slice(0),o=e.slice(0),r=this.call("beforeOptimizeBlocks",r,o),i=0;null!=r[i];)a=!1,n=r[i],h=null!=r[i-1]?r[i-1]:null,c=null!=r[i+1]?r[i+1]:null,u=n[0],s=n[1],p=n[2],"pre"===u&&(l=o.slice(n[1],n[2]+1).reduce(function(t,e){return e.match(/^\s*$/)&&t},!0),l&&(n[0]=u="normal")),"normal"===u&&(f=["list","quote"],s===p&&o[s].match(/^\s*$/)&&null!=h&&null!=c&&h[0]===c[0]&&f.indexOf(h[0])>=0&&(r[i-1]=[h[0],h[1],c[2],null],r.splice(i,2),a=!0)),a||(i+=1);return this.call("afterOptimizeBlocks",r,o)},t.prototype.parseCode=function(t,e,n){var r,l,i,o,c,h;return r=e[0],o=e[1],o=a(o),l=r.length,o.match(/^[_a-z0-9-\+\#\:\.]+$/i)?(e=o.split(":"),e.length>1&&(o=e[0],c=e[1],o=a(o),c=a(c))):o=null,i=!0,t=t.slice(1,-1).map(function(t){return t=t.replace(new RegExp("/^[ ]{"+l+"}/"),""),i&&!t.match(/^\s*$/)&&(i=!1),s(t)}),h=this.markLines(t,n+1).join("\n"),i?"":"<pre><code"+(o?' class="language-'+o+'"':"")+(c?' rel="'+c+'"':"")+">"+h+"</code></pre>"},t.prototype.parsePre=function(t,e,n){var r;return t=t.map(function(t){return s(t.substring(4))}),r=this.markLines(t,n).join("\n"),r.match(/^\s*$/)?"":"<pre><code>"+r+"</code></pre>"},t.prototype.parseAhtml=function(t,e,n){return a(this.markLines(t,n).join("\n"))},t.prototype.parseShtml=function(t,e,n){return a(this.markLines(t.slice(1,-1),n+1).join("\n"))},t.prototype.parseMath=function(t,e,n,r){return"<p>"+this.markLine(n,r)+s(t.join("\n"))+"</p>"},t.prototype.parseSh=function(t,e,n,r){var s;return s=this.markLine(n,r)+this.parseInline(a(t[0],"# ")),s.match(/^\s*$/)?"":"<h"+e+">"+s+"</h"+e+">"},t.prototype.parseMh=function(t,e,n,r){return this.parseSh(t,e,n,r)},t.prototype.parseQuote=function(t,e,n){var r;return t=t.map(function(t){return t.replace(/^\s*> ?/,"")}),r=t.join("\n"),r.match(/^\s*$/)?"":"<blockquote>"+this.parse(r,!0,n)+"</blockquote>"},t.prototype.parseList=function(t,e,n){var r,s,l,i,o,a,c,h,p,u,f,k,m,g,d,B,b,y,v,$;for(s="",m=99999,b=99999,r=!1,B=!1,d=[],i=l=0,p=t.length;l<p;i=++l)f=t[i],(k=f.match(/^(\s*)((?:[0-9]+\.?)|\-|\+|\*)(\s+)(.*)$/i))?(y=k[1].length,$=0<="+-*".indexOf(k[2])?"ul":"ol",m=Math.min(y,m),r=!0,y>0&&(b=Math.min(y,b),B=!0),d.push([y,$,f,k[4]])):(d.push(f),(k=f.match(/^(\s*)/))&&(y=k[1].length,y>0&&(b=Math.min(y,b),B=!0)));for(m=r?m:0,b=B?b:m,a="",c=[],h=0,i=o=0,u=d.length;o<u;i=++o)g=d[i],g instanceof Array?(y=g[0],$=g[1],f=g[2],v=g[3],y!==m?c.push(f.replace(new RegExp("^\\s{"+b+"}"),"")):(c.length>0&&(s+="<li>"+this.parse(c.join("\n"),!0,n+h)+"</li>"),a!==$&&(a&&(s+="</"+a+">"),s+="<"+$+">"),h=i,c=[v],a=$)):c.push(g.replace(new RegExp("^\\s{"+b+"}"),""));return c.length>0&&(s+="<li>"+this.parse(c.join("\n"),!0,n+h)+"</li></"+a+">"),s},t.prototype.parseTable=function(t,e,n){var r,s,l,i,o,c,h,p,u,f,k,m,g,d,B,b,y,v,$,x;for(h=e[0],r=e[1],o=h.length>0&&h.reduce(function(t,e){return e+t})>0,c="<table>",s=!o||null,b=!1,u=p=0,m=t.length;p<m;u=++p)if(d=t[u],0<=h.indexOf(u))o&&b&&(o=!1,s=!0);else{for(d=a(d),b=!0,"|"===d[0]&&(d=d.substring(1),"|"===d[d.length-1]&&(d=d.substring(0,d.length-1))),v=d.split("|").map(function(t){return t.match(/^\s*$/)?" ":a(t)}),i={},k=-1,f=0,g=v.length;f<g;f++)y=v[f],y.length>0?(k+=1,i[k]=[null!=i[k]?i[k][0]+1:1,y]):null!=i[k]?i[k][0]+=1:i[0]=[1,y];for(u in o?c+="<thead>":s&&(c+="<tbody>"),c+="<tr",this.line&&(c+=' class="line" data-start="'+(n+u)+'" data-end="'+(n+u)+'" data-id="'+this.uniqid+'"'),c+=">",i)l=i[u],B=l[0],x=l[1],$=o?"th":"td",c+="<"+$,B>1&&(c+=' colspan="'+B+'"'),null!=r[u]&&"none"!==r[u]&&(c+=' align="'+r[u]+'"'),c+=">"+this.parseInline(x)+"</"+$+">";c+="</tr>",o?c+="</thead>":s&&(s=!1)}return null!==s&&(c+="</tbody>"),c+"</table>"},t.prototype.parseHr=function(t,e,n){return this.line?'<hr class="line" data-start="'+n+'" data-end="'+n+'">':"<hr>"},t.prototype.parseNormal=function(t,e,n){var r,s,l;return null==e&&(e=!1),r=0,t=t.map((l=this,function(t){return t=l.parseInline(t),t.match(/^\s*$/)||(t=l.markLine(n+r)+t),r+=1,t})),s=a(t.join("\n")),s=s.replace(/(\n\s*){2,}/g,"</p><p>"),s=s.replace(/\n/g,"<br>"),s.match(/^\s*$/)?"":e?s:"<p>"+s+"</p>"},t.prototype.parseFootnote=function(t,e){var n,r;return e[0],r=e[1],n=this.footnotes.indexOf(r),n>=0&&(t=t.slice(0),t[0]=t[0].replace(/^\[\^((?:[^\]]|\]|\[)+?)\]:/,""),this.footnotes[n]=t),""},t.prototype.parseDefinition=function(){return""},t.prototype.parseHtml=function(t,e,n){var r;return t=t.map((r=this,function(t){return r.parseInline(t,null!=r.specialWhiteList[e]?r.specialWhiteList[e]:"")})),this.markLines(t,n).join("\n")},t.prototype.cleanUrl=function(t){var e,n,r;return n=new RegExp("^\\s*((http|https|ftp|mailto):["+l+"_a-z0-9-:\\.\\*/%#;!@\\?\\[\\]\\+=~\\|\\,&\\(\\)]+)","i"),r=new RegExp("^\\s*(["+l+"_a-z0-9-:\\.\\*/%#!@\\?\\+=~\\|\\,&]+)","i"),(e=t.match(n))?e[1]:(e=t.match(r))?e[1]:"#"},t.prototype.escapeBracket=function(t){return o(["\\[","\\]","\\(","\\)"],["[","]","(",")"],t)},t.prototype.startBlock=function(t,e,n){return null==n&&(n=null),this.pos+=1,this.current=t,this.blocks.push([t,e,e,n]),this},t.prototype.endBlock=function(){return this.current="normal",this},t.prototype.isBlock=function(t,e){return null==e&&(e=null),this.current===t&&(null===e||this.blocks[this.pos][3]===e)},t.prototype.getBlock=function(){return null!=this.blocks[this.pos]?this.blocks[this.pos]:null},t.prototype.setBlock=function(t,e){return null==t&&(t=null),null==e&&(e=null),null!==t&&(this.blocks[this.pos][2]=t),null!==e&&(this.blocks[this.pos][3]=e),this},t.prototype.backBlock=function(t,e,n){var r,s;return null==n&&(n=null),this.pos<0?this.startBlock(e,0,n):(s=this.blocks[this.pos][2],this.blocks[this.pos][2]=s-t,r=[e,s-t+1,s,n],this.blocks[this.pos][1]<=this.blocks[this.pos][2]?(this.pos+=1,this.blocks.push(r)):this.blocks[this.pos]=r,this.current=e,this)},t.prototype.combineBlock=function(){var t,e;return this.pos<1?this:(e=this.blocks[this.pos-1].slice(0),t=this.blocks[this.pos].slice(0),e[2]=t[2],this.blocks[this.pos-1]=e,this.current=e[0],this.blocks=this.blocks.slice(0,-1),this.pos-=1,this)},t}(),"undefined"!=typeof module&&null!==module?module.exports=t:"undefined"!=typeof window&&null!==window&&(window.HyperDown=t)}).call(this);